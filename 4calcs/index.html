<!DOCTYPE html>
<html manifest="">

<title>4CALCS</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=2.0, minimum-scale=1.0">
<meta name="format-detection" content="telephone=no">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<script src="js/utils.js?"></script>
<script src="js/divafw.js?"></script>

<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:700" rel="stylesheet">

<style>
  body {padding:0;margin:0;background:#000;}
  div.view {position:absolute;margin:auto;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;box-sizing: border-box;}
  div.view.scroll { z-index:-1;}
  * {font-family:verdana,sans-serif;box-sizing:border-box;}
  input,input:active {-webkit-appearance:none;appearance:none;width:100%;border:0px;outline:0px;-webkit-tap-highlight-color:rgba(0,0,0,0);tap-highlight-color:rgba(0,0,0,0);}
    svg{display:block;margin:0;padding:0;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;box-sizing: border-box;}
</style>
<script src="js/calc.js"></script>
<script>
window.onload = function() {
    var deviceWidth = Math.round(document.documentElement.clientWidth);
    var deviceHeight = Math.round(document.documentElement.clientHeight);

    
    var SIZE = Math.min(deviceWidth/4,deviceHeight/6.4);
    AFW.default.fontSize = SIZE/4;
    var formula = new Formula("0");
    
    
    
    
    {
        
//        if (Math.min(deviceWidth,deviceHeight)>640) {
//            document.querySelector("meta[name=viewport]").content = "initial-scale=2, user-scalable=no,maximum-scale=2.0";
//        }
        console.log(SIZE)
    }
    
    var btn_txt = {"*":"&times;", "/":"&divide;"}
    
    var CalcButton = function(col, row, txt) {
        
        var bgcolor = "#405060";
        var fgcolor = "#ddd";
        
        if ("0123456789, ".indexOf(txt)>-1) {
            bgcolor="#404448";
        } 
        if (txt=="<") {
            bgcolor="#485868";
        } else if (txt=="C") {
            bgcolor="#c93";
        }
        
        var lbl_txt = new AFW.Label({top:0,right:0,left:0,bottom:0,color:"#fff"}, btn_txt[txt]?btn_txt[txt]:txt);
        var width = txt=="0"?SIZE*2-1:SIZE-1;
        var height = txt=="="?SIZE*2-1:SIZE-1;
        
        AFW.Button.call(this, {top:row*SIZE+1,left:col*SIZE+1,width:width,height:height,background:"#000"}, calcButtonAction, function() {this.setBackground("#eee");lbl_txt.setForeground("#000");}, function() {this.setBackground(bgcolor);lbl_txt.setForeground(fgcolor);});
        this.appendChild(lbl_txt);
        
        this.getTxt = function() {return txt;}

        
        
        this.activate = function() {
            this.setActive(true);
            this.setBackground(bgcolor);
            lbl_txt.setForeground(fgcolor);
        }.bind(this);

        this.deactivate = function() {
            this.setActive(false);
            this.setBackground("#ddd");
            lbl_txt.setForeground("#fff");
        }.bind(this);

        this.activate();
    }
    var display_txt = "0";
    var last_result = "";
    
    function calcButtonAction(sender) {
        var dgts = "0123456789.,"
        var oprs = "+-/*"
        var btn = sender.getTxt();
        
        var show = "";
        var hist = "";
        
        if (btn == "C") {
            formula = new Formula("0");
            show = formula.getDisplay();
        } else if (btn == "=") {
            var result = formula.evaluate();
            show = "= "+result;
            
            last_result += "<br>"+formula.getDisplay() + " = "+result;
            formula = new Formula(result);
        } else if (dgts.indexOf(btn)>-1) {
            formula.addDigit(btn);
            show = formula.getDisplay();
        } else if (oprs.indexOf(btn)>-1) {
            formula.setOperator(btn);
            show = formula.getDisplay();
        }
        
        if (show=="") show="0"
        lbl_display.setHtml(show);
        lbl_history.setHtml(last_result);
    }
    
    var view_calc = new AFW.View({top:0,left:0,bottom:0,right:0, width:SIZE*4, background:"#29272C"});
    var view_buttons = new AFW.View({bottom:1,right:0,height:SIZE*5,width:SIZE*4});
    var view_display = new AFW.View({top:0,bottom:SIZE*5,left:0,right:SIZE/8,xbackground:"red"});
    
    var lbl_history = new AFW.Label({bottom:SIZE*.75,right:0,color:"#888",textAlign:"right",fontSize:"75%"}, "");
    var lbl_display = new AFW.Label({bottom:0,right:0,height:SIZE*.75,color:"#c93",fontSize:"150%"}, "0,11234");
    view_display.appendChild(lbl_display);
    view_display.appendChild(lbl_history);
    
    
    var buttons = ["C/*<","789+", "456-", "123=", "0 ,"];
    
    for (var row in buttons) {
        for (var col in buttons[row]) {
            if (buttons[row][col] == " ") continue;
            var b0 = new CalcButton(col,row, buttons[row][col]);
            view_buttons.appendChild(b0);
        }
    }
    lbl_display.setHtml("0");
    view_calc.appendChild(view_buttons);
    view_calc.appendChild(view_display);
    AFW.appendChild(view_calc);

} //onload

</script>

<body>
<div id="viewport" style="position:fixed;top:0;left:0;bottom:0;right:0;"></div>
</body>

</html>
